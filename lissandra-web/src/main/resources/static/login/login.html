<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="./img/apple-icon.png"/>
    <link rel="icon" type="image/png" href="./img/favicon.png"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>登录 - 电子商务界面交易平台</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
          name='viewport'/>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"/>
    <link href="./css/bootstrap.min.css" rel="stylesheet"/>
    <link href="./css/now-ui-kit.css?v=1.1.0" rel="stylesheet"/>
    <link href="./css/login.css" rel="stylesheet"/>
    <!-- Canonical SEO -->
    <link rel="canonical" href=""/>
    <!--  Social tags      -->
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
</head>

<body class="login-page sidebar-collapse">
<div class="page-header" filter-color="orange">
    <div class="page-header-image" style="background-image:url(./img/login.jpg)"></div>
    <div class="container">
        <div class="col-md-4 content-center">
            <div class="card card-login card-plain">
                <form class="form" method="" action="" autocomplete="off">
                    <div class="header header-primary text-center">
                        <div class="logo-container">
                            <img src="./img/now-logo.png" alt=""/>
                        </div>
                    </div>

                    <!--登录模块-->
                    <div class="login_module" id="login_module">
                        <div class="content">
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons users_circle-08"></i>
                                </span>
                                <input type="text" id="loginPhone" class="form-control" placeholder="Phone Number"
                                       minlength="11"
                                       maxlength="11" autocomplete="off"
                                       onkeyup="this.value=this.value.replace(/\D/g,'')"
                                       onafterpaste="this.value=this.value.replace(/\D/g,'')"
                                />
                            </div>
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons text_caps-small"></i>
                                </span>
                                <input type="password" id="loginPassword" placeholder="Password" class="form-control"/>
                            </div>
                        </div>
                        <div class="footer text-center">
                            <a href="#" class="btn btn-primary btn-round btn-lg btn-block" onclick="toLogin()">Enter
                                System</a>
                        </div>
                        <div class="pull-left">
                            <h6>
                                <a href="#" onclick="changeModule()" class="link"> Register </a>
                            </h6>
                        </div>
                    </div>


                    <!--注册模块-->
                    <div class="register_module" id="register_module">
                        <div class="content">
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons users_circle-08"></i>
                                </span>
                                <input type="text" id="registerName" class="form-control" placeholder="Register Name"
                                />
                            </div>
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons users_circle-08"></i>
                                </span>
                                <select id="registerPermission" class="form-control" style="width: 320px; height: 46px;border-radius: 0;
                                    -webkit-border-radius: 0;-webkit-appearance: button; border-top-right-radius: 30px; border-bottom-right-radius: 30px;">
                                    <option disabled="disabled" selected="selected" hidden="hidden" value="9">Register
                                        Role
                                    </option>
                                    <option value="0">管理员</option>
                                    <option value="1">品牌商</option>
                                    <option value="2">借卖方</option>
                                </select>
                            </div>
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons users_circle-08"></i>
                                </span>
                                <input type="text" id="registerPhone" class="form-control" placeholder="Register Phone"
                                       maxlength="11"
                                       onkeyup="this.value=this.value.replace(/\D/g,'')"
                                       onafterpaste="this.value=this.value.replace(/\D/g,'')"/>
                            </div>
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons text_caps-small"></i>
                                </span>
                                <input type="password" id="firstPassword" placeholder="New Password"
                                       class="form-control" onkeyup="validate()"/>
                            </div>
                            <div class="input-group form-group-no-border input-lg">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons text_caps-small"></i>
                                </span>

                                <input type="password" id="confirmPassword" placeholder="Confirm Password"
                                       class="form-control" onkeyup="validate()"/>
                            </div>
                        </div>
                        <div class="footer text-center">
                            <a href="#" class="btn btn-primary btn-round btn-lg btn-block" id="submit"
                               onclick="toRegister()">
                                Register </a>
                        </div>
                        <div class="pull-left">
                            <h6>
                                <a href="#" onclick="changeModule()" class="link"> Back </a>
                            </h6>
                        </div>
                    </div>


                </form>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="copyright">
                Lissandra v1.0 ©Copyright ShiYiJie® 2018-2088
            </div>
        </div>
    </footer>
</div>
</body>
<script src="./js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="./js/core/popper.min.js" type="text/javascript"></script>
<script src="./js/core/bootstrap.min.js" type="text/javascript"></script>
<script src="./js/plugins/bootstrap-switch.js"></script>
<script src="./js/plugins/nouislider.min.js" type="text/javascript"></script>
<script src="./js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="./js/plugins/jquery.sharrre.js" type="text/javascript"></script>
<script src="./js/now-ui-kit.js?v=1.1.0" type="text/javascript"></script>

<script type="text/javascript">

    var registerConut = 0;

    //登录注册模块切换
    function changeModule() {
        if ($("#register_module").css("display") === "none") {
            console.log("register_module");
            $("#register_module").show();
            $("#login_module").css("display", "none");
            //清除原文本
            $("#registerName").val("");
            $("#registerPermission").val("9");
            $("#registerPhone").val("");
        } else {
            console.log("login_module");
            $("#login_module").show();
            $("#register_module").css("display", "none");
        }

    }

    function registeValidate() {
        const phone = $("#registerPhone").val();
        const pwd = $("#firstPassword").val();
        const cpwd = $("#confirmPassword").val();

        if (pwd === '' || cpwd === '') {
            return;
        }

        if (phone.length !== 11) {
            $("#submit").attr("disabled", "true");
            $("#submit").html("Phone Too Short");
            $("#submit").attr("style", "background-color: gray");
        } else if (pwd === cpwd) {
            $("#submit").removeAttr("disabled");
            $("#submit").attr("style", "background-color: ##f96332");
            $("#submit").html("Register");
            registerConut++;
        } else {
            $("#submit").attr("disabled", "true");
            //document.getElementById("submit").disabled = true;
            $("#submit").html("Password Not Match");
            $("#submit").attr("style", "background-color: gray");
            registerConut++;
        }

    }

    function validate() {
        if (registerConut === 0) {
            setTimeout(function () {
                registeValidate();
            }, 1000);
        } else {
            registeValidate();
        }
    }

    function toLogin() {
        const phone = $("#loginPhone").val();
        const pwd = $("#loginPassword").val();
        login(phone, pwd);
    }

    function toRegister() {

        const name = $("#registerName").val();
        const permission = $("#registerPermission").val();
        const phone = $("#registerPhone").val();
        const pwd = $("#firstPassword").val();
        register(name, permission, phone, pwd);
    }

    function login(phone, password) {
        const user = {
            "phone": phone,
            "password": password
        };
        $.ajax({
            type: "POST",
            url: "../api/login.json",
            data: JSON.stringify(user),
            cache: false,
            async: false,
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if ("OK" === data.data) {
                    window.location.href = "../index.html";
                } else if ("1000" === data.code) {
                    alert("账号或密码错误！ ");
                    return false;
                }
            },
            error: function (data) {
                alert("登录失败！ " + data.message);
            }

        })
    }

    function register(name, permission, phone, password) {
        const user = {
            "userName": name,
            "permission": permission,
            "phone": phone,
            "password": password
        };
        $.ajax({
            type: "POST",
            url: "../api/register.json",
            data: JSON.stringify(user),
            cache: false,
            async: false,
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                location.href = "../login/login.html";
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert("请求失败！" + errorThrown);
            }

        })
    }


    //键盘回车 - 登录
    $(document).keyup(function (event) {
        if (event.keyCode === 13) {
            toLogin();
        }
    });

</script>

</html>
